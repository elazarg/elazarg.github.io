<!-- based on https://www.youtube.com/watch?v=xGmXxpIj6vs -->
<canvas id="gc"></canvas>
<script>
    function game(canv) {

        gs = 20;
        tcx = Math.floor(canv.width / gs - 1);
        tcy = Math.floor(canv.height / gs - 1);

        px = Math.floor(tcx / 2);
        py = Math.floor(tcy / 2);
        ax = ay = 0;
        function put_apple() {
            ax = Math.floor(Math.random() * tcx);
            ay = Math.floor(Math.random() * tcy);
        }
        xv = yv = 0;
        trail = [];
        tail = 5;
        moved = true;
        put_apple();
        function draw_square(px, py, color) {
            ctx.fillStyle = color;
            ctx.fillRect(px * gs + 1, py * gs + 1, gs - 1, gs - 1);
        }

        return {
            keyPush: function keyPush(evt) {
                if (!moved) return;
                switch (evt.keyCode) {
                    case 37:
                        if (xv == 0) { xv = -1; yv = 0; }
                        break;
                    case 38:
                        if (yv == 0) { xv = 0; yv = -1; }
                        break;
                    case 39:
                        if (xv == 0) { xv = 1; yv = 0; }
                        break;
                    case 40:
                        if (yv == 0) { xv = 0; yv = 1; }
                        break;
                }
                moved = false;
            },
            step: function step() {
                moved = true;
                px += xv;
                py += yv;
                if (px < 0) {
                    px = tcx - 1;
                }
                if (px > tcx - 1) {
                    px = 0;
                }
                if (py < 0) {
                    py = tcy - 1;
                }
                if (py > tcy - 1) {
                    py = 0;
                }
                ctx.fillStyle = "black";
                ctx.fillRect(0, 0, gs * tcx, gs * tcy);

                for (var i = 0; i < trail.length; i++) {
                    draw_square(trail[i].x, trail[i].y, "lime");
                    if (trail[i].x == px && trail[i].y == py) {
                        tail = 5;
                    }
                }
                draw_square(px, py, "white");
                trail.push({ x: px, y: py });
                while (trail.length > tail) {
                    trail.shift();
                }

                if (ax == px && ay == py) {
                    tail++;
                    put_apple();
                }
                draw_square(ax, ay, "red");
            }
        }
    }
    window.onload = function () {
        canv = document.getElementById("gc");
        ctx = canv.getContext("2d");
        canv.width = document.body.clientWidth - 20;
        canv.height = document.body.clientHeight - 20;
        g = game(canv);
        document.addEventListener("keydown", g.keyPush);
        setInterval(g.step, 1000 / 10); // /15
    }

</script>