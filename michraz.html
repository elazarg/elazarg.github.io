<html lang="he" dir="rtl">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.4.3/css/foundation.min.css"/>
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/zf/jq-3.3.1/dt-1.10.25/b-1.7.1/b-colvis-1.7.1/b-html5-1.7.1/cr-1.5.4/fh-3.1.9/sp-1.3.0/datatables.min.css"/>
   
  <script type="text/javascript" src="https://cdn.datatables.net/v/zf/jq-3.3.1/dt-1.10.25/b-1.7.1/b-colvis-1.7.1/b-html5-1.7.1/cr-1.5.4/fh-3.1.9/sp-1.3.0/datatables.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.4.3/js/foundation.min.js"></script>  
<body>

<form id="jsonFile" name="jsonFile" enctype="multipart/form-data" method="post">

  <fieldset>
    <h2>העלה קובץ</h2>
     <input type='file' id='fileinput' value="בחר קובץ">
     <input type='button' id='btnLoad' value="טען" onclick='loadFile();'>
  </fieldset>
</form>

<div id="myTables"></div>

<script type="text/javascript">

  const tables = document.getElementById("myTables");


  Object.values = obj => Object.keys(obj).map(key => obj[key]);
  var j;
  function loadFile() {
    var input, file, fr;

    if (typeof window.FileReader !== 'function') {
      alert("The file API isn't supported on this browser yet.");
      return;
    }

    input = document.getElementById('fileinput');
    if (!input) {
      alert("Um, couldn't find the fileinput element.");
    }
    else if (!input.files) {
      alert("This browser doesn't seem to support the `files` property of file inputs.");
    }
    else if (!input.files[0]) {
      alert("Please select a file before clicking 'Load'");
    }
    else {
      file = input.files[0];
      fr = new FileReader();
      fr.onload = receivedText;
      fr.readAsText(file);
    }

    function receivedText(e) {
      let lines = e.target.result;
      var newArr = JSON.parse(lines); 
      j = newArr;
      
      function header(item) {
        return Object.keys(item).join(",");
      }
      for (let michraz of j) {
        const tikList = [];
        for (const tik of michraz["Tik"]) {
            for (const mpHatzaaotMitcham of tik["mpHatzaaotMitcham"]) {
              const item = {...tik, ...mpHatzaaotMitcham};
              tikList.push(item);
              const toDelete = ["mechirShuma", "TmuraMufchetet", "MechirMaximum",	"SchumArvut", "TochnitMigrash", "TosefetLatmura", "mpHatzaaotMitcham", "GushHelka"];
              for (const key of toDelete) {
                delete item[key];
              }
            }
        }
        console.log(tikList);

        const table = document.createElement("table");
        tables.appendChild(table);

        const thead = document.createElement("thead");
        table.appendChild(thead);
        const header = document.createElement("tr");
        thead.appendChild(header);

        for (const item of Object.keys(tikList[0])) {
          const cell = document.createElement("th");
          cell.textContent = item;
          header.appendChild(cell);
        }
                
        const tbody = document.createElement("tbody");
        table.appendChild(tbody);

        for (let tik of tikList) {
          const row = document.createElement("tr");
          tbody.appendChild(row);
          for (const item of Object.values(tik)) {
            const cell = document.createElement("td");
            cell.textContent = item;
            row.appendChild(cell);
          }
        }
        $(table).DataTable();
      }
    }
  }
</script>

</body>
</html>